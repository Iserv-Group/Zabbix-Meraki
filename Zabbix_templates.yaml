zabbix_export:
  version: '5.4'
  date: '2021-10-27T19:27:54Z'
  groups:
    -
      uuid: 1566d650da3848abab777d5e05771a0d
      name: Meraki_Autodiscover
    -
      uuid: 7936c08607e34b5eb4cdcb1e64eeaac3
      name: Templates/api
    -
      uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
      name: Templates/Applications
    -
      uuid: 36bff6c29af64692839d077febfc7079
      name: 'Templates/Network devices'
  templates:
    -
      uuid: 2871aa11e6194a33b866bddecf6a722b
      template: 'Meraki Device Discovery'
      name: 'Meraki Device Discovery'
      description: 'Template used to create Zabbix items and triggers for all devices on a given Meraki Network. Data Pulled automatically from Dashboard API export.'
      groups:
        -
          name: Templates/api
        -
          name: Templates/Applications
        -
          name: 'Templates/Network devices'
      items:
        -
          uuid: cc8f795379ac4389b60aac9aadb246cd
          name: '{HOSTNAME} data pull'
          type: EXTERNAL
          key: 'meraki.sh[network.data,{$NETWORK_ID}]'
          history: 7d
          trends: '0'
          value_type: TEXT
          tags:
            -
              tag: Application
              value: Network
        -
          uuid: 9447301c9da748f4bcfd773a5bb799c4
          name: '{HOSTNAME} Status Check'
          type: DEPENDENT
          key: 'network.status[{$NETWORK_ID}]'
          delay: '0'
          valuemap:
            name: 'Meraki Device Status'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.*.status'
            -
              type: STR_REPLACE
              parameters:
                - '"online"'
                - '2'
            -
              type: STR_REPLACE
              parameters:
                - '"alerting"'
                - '1'
            -
              type: STR_REPLACE
              parameters:
                - '"offline"'
                - '0'
            -
              type: TRIM
              parameters:
                - '[]'
            -
              type: JAVASCRIPT
              parameters:
                - |
                  var myArray = value.split(",").map(Number);
                  var max = myArray.reduce(function(a, b) {
                      return Math.max(a, b);
                  });
                  return max
          master_item:
            key: 'meraki.sh[network.data,{$NETWORK_ID}]'
          tags:
            -
              tag: Application
              value: Network
          triggers:
            -
              uuid: dde26ea4cc1940a393823e104bbb4ae6
              expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],4m)=0'
              name: 'Network Unreachable for 5 Minute'
              priority: INFO
              description: 'All devices on this Meraki Network have been unreachable from the Meraki dashboard in 5 min.'
              dependencies:
                -
                  name: 'Network Unreachable for 10 Minute'
                  expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],10m)=0'
                -
                  name: 'Network Unreachable for 15 Minute'
                  expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
            -
              uuid: 17dadac78d1d4b59b4ad10d6180e1de9
              expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],10m)=0'
              name: 'Network Unreachable for 10 Minute'
              priority: WARNING
              description: 'All devices on this Meraki Network have been unreachable from the Meraki dashboard in 10 min.'
              dependencies:
                -
                  name: 'Network Unreachable for 15 Minute'
                  expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
            -
              uuid: 541793cc39904fa6ade847eb8d535802
              expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
              name: 'Network Unreachable for 15 Minute'
              priority: AVERAGE
              description: |
                All devices on this Meraki Network have been unreachable from the Meraki dashboard in 15 min.
                <b>Notes from Meraki Dashboard</b>
                {$MX_NOTES}
      discovery_rules:
        -
          uuid: 61933fb8fd704ac7bbf85ef78c61d3e5
          name: 'Discover Meraki Devices'
          type: EXTERNAL
          key: 'meraki.sh[device.discovery, {$NETWORK_ID}]'
          delay: 1d
          lifetime: 7d
          item_prototypes:
            -
              uuid: 100833028dce4ca38a6cc46818f78ca5
              name: '{#NAME} Status Check'
              type: DEPENDENT
              key: 'device.status[{#SERIAL}]'
              delay: '0'
              trends: 180d
              valuemap:
                name: 'Meraki Device Status'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.serial == ''{#SERIAL}'')].status'
                -
                  type: STR_REPLACE
                  parameters:
                    - '["online"]'
                    - '2'
                -
                  type: STR_REPLACE
                  parameters:
                    - '["alerting"]'
                    - '1'
                -
                  type: STR_REPLACE
                  parameters:
                    - '["offline"]'
                    - '0'
              master_item:
                key: 'meraki.sh[network.data,{$NETWORK_ID}]'
              tags:
                -
                  tag: Application
                  value: Device
              trigger_prototypes:
                -
                  uuid: 7579aa1ae01647038ff1962641d553d2
                  expression: 'max(/Meraki Device Discovery/device.status[{#SERIAL}],6m)=0'
                  name: '{#NAME} Unreachable for 5 Minute'
                  priority: INFO
                  description: |
                    The following device has been unreachable from the Meraki cloud for 5 min
                    <b>Meraki Org and Network Name:</b>  <i>{HOST.NAME}</i>
                    <b>Meraki Device Name:</b>  <i>{#NAME}</i>
                  dependencies:
                    -
                      name: 'Network Unreachable for 5 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],4m)=0'
                    -
                      name: 'Network Unreachable for 10 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],10m)=0'
                    -
                      name: 'Network Unreachable for 15 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
                    -
                      name: '{#NAME} Unreachable for 10 Minute'
                      expression: 'max(/Meraki Device Discovery/device.status[{#SERIAL}],11m)=0'
                    -
                      name: '{#NAME} Unreachable for 15 Minute'
                      expression: 'max(/Meraki Device Discovery/device.status[{#SERIAL}],16m)=0'
                -
                  uuid: 9e22482e67284e5f99794ffa9faa5f1f
                  expression: 'max(/Meraki Device Discovery/device.status[{#SERIAL}],11m)=0'
                  name: '{#NAME} Unreachable for 10 Minute'
                  priority: WARNING
                  description: |
                    The following device has been unreachable from the Meraki cloud for 10 min
                    <b>Meraki Org and Network Name:</b>  <i>{HOST.NAME}</i>
                    <b>Meraki Device Name:</b>  <i>{#NAME}</i>
                  dependencies:
                    -
                      name: 'Network Unreachable for 10 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],10m)=0'
                    -
                      name: 'Network Unreachable for 15 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
                    -
                      name: '{#NAME} Unreachable for 15 Minute'
                      expression: 'max(/Meraki Device Discovery/device.status[{#SERIAL}],16m)=0'
                -
                  uuid: cc210261c72e4ba9b86efc6732bdf866
                  expression: 'max(/Meraki Device Discovery/device.status[{#SERIAL}],16m)=0'
                  name: '{#NAME} Unreachable for 15 Minute'
                  priority: AVERAGE
                  description: |
                    The following device has been unreachable from the Meraki cloud for 15 min
                    <b>Meraki Org and Network Name:</b>  <i>{HOST.NAME}</i>
                    <b>Meraki Device Name:</b>  <i>{#NAME}</i>
                  dependencies:
                    -
                      name: 'Network Unreachable for 15 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
        -
          uuid: 658568e2bd0c44009b7ad59cc5fba902
          name: 'Discovered WAN Connections'
          type: EXTERNAL
          key: 'meraki.sh[wan.discovery,{$NETWORK_ID}]'
          delay: 1d
          lifetime: 7d
          item_prototypes:
            -
              uuid: 6fc2b1a754f846dd96e8b001a8eee341
              name: '{#INT_NAME} on {#NAME} Status Check'
              type: DEPENDENT
              key: 'wan.status[{#SERIAL},{#INT_NAME}]'
              delay: '0'
              history: 30d
              trends: 180d
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.serial == ''{#SERIAL}'')].uplinks'
                -
                  type: JSONPATH
                  parameters:
                    - '$.*.*'
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.interface == ''{#INT_NAME}'')].status'
                -
                  type: STR_REPLACE
                  parameters:
                    - '["active"]'
                    - '3'
                -
                  type: STR_REPLACE
                  parameters:
                    - '["ready"]'
                    - '2'
                -
                  type: STR_REPLACE
                  parameters:
                    - '["failed"]'
                    - '1'
                -
                  type: STR_REPLACE
                  parameters:
                    - '["not connected"]'
                    - '0'
              master_item:
                key: 'meraki.sh[network.data,{$NETWORK_ID}]'
              tags:
                -
                  tag: Application
                  value: WAN
              trigger_prototypes:
                -
                  uuid: f93c3791b9a2478dbdb9c58847333486
                  expression: 'max(/Meraki Device Discovery/wan.status[{#SERIAL},{#INT_NAME}],15m)=1'
                  name: '{#INT_NAME} on {#NAME} down for 15 min'
                  priority: INFO
                  description: |
                    The {#INT_NAME} connection at this location has been down for over 15 min.
                    <b>Notes from Meraki Dashboard</b>
                    {#NOTES}
                  dependencies:
                    -
                      name: 'Network Unreachable for 5 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],4m)=0'
                    -
                      name: 'Network Unreachable for 10 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],10m)=0'
                    -
                      name: 'Network Unreachable for 15 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
                    -
                      name: '{#INT_NAME} on {#NAME} down for 30 min'
                      expression: 'max(/Meraki Device Discovery/wan.status[{#SERIAL},{#INT_NAME}],30m)=1'
                    -
                      name: '{#INT_NAME} on {#NAME} down for 60 min'
                      expression: 'max(/Meraki Device Discovery/wan.status[{#SERIAL},{#INT_NAME}],60m)=1'
                -
                  uuid: 88b2e178c8364115b4565bd3dec72e92
                  expression: 'max(/Meraki Device Discovery/wan.status[{#SERIAL},{#INT_NAME}],30m)=1'
                  name: '{#INT_NAME} on {#NAME} down for 30 min'
                  priority: WARNING
                  description: |
                    The {#INT_NAME} connection at this location has been down for over 30 min.
                    <b>Notes from Meraki Dashboard</b>
                    {#NOTES}
                  dependencies:
                    -
                      name: 'Network Unreachable for 10 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],10m)=0'
                    -
                      name: 'Network Unreachable for 15 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
                    -
                      name: '{#INT_NAME} on {#NAME} down for 60 min'
                      expression: 'max(/Meraki Device Discovery/wan.status[{#SERIAL},{#INT_NAME}],60m)=1'
                -
                  uuid: d40ede3dd22c4dd1a186e5d0184d8d4b
                  expression: 'max(/Meraki Device Discovery/wan.status[{#SERIAL},{#INT_NAME}],60m)=1'
                  name: '{#INT_NAME} on {#NAME} down for 60 min'
                  priority: AVERAGE
                  description: |
                    The {#INT_NAME} connection at this location has been down for over 60 min.
                    <b>Notes from Meraki Dashboard</b>
                    {#NOTES}
                  dependencies:
                    -
                      name: 'Network Unreachable for 15 Minute'
                      expression: 'max(/Meraki Device Discovery/network.status[{$NETWORK_ID}],15m)=0'
      valuemaps:
        -
          uuid: 59e05ea9dc7c45d697ec7e5441fd5f7f
          name: 'Meraki Device Status'
          mappings:
            -
              value: '0'
              newvalue: Offline
            -
              value: '1'
              newvalue: Alerting
            -
              value: '2'
              newvalue: Online
    -
      uuid: 2d78a8beb3d741739ca5a53cc0947a83
      template: 'Meraki Network Discovery'
      name: 'Meraki Network Discovery'
      description: 'Template used to create Meraki Hosts automatically from Dashboard API export.'
      groups:
        -
          name: Templates/api
        -
          name: Templates/Applications
        -
          name: 'Templates/Network devices'
      items:
        -
          uuid: 56ddd05640044a05bfc21b21e00539b4
          name: 'Meraki Error Data Pull'
          type: EXTERNAL
          key: 'meraki.sh[errors.list]'
          trends: '0'
          value_type: TEXT
        -
          uuid: 4708dfce20cb4053bc62dd4bae35fdde
          name: 'Meraki error count'
          type: DEPENDENT
          key: 'Meraki_error[count]'
          delay: '0'
          history: 7d
          trends: 30d
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.errors_count
          master_item:
            key: 'meraki.sh[errors.list]'
        -
          uuid: 325d8a549c124fe09f02b354dfb83429
          name: 'Meraki error list'
          type: DEPENDENT
          key: 'Meraki_error[list]'
          delay: '0'
          history: 7d
          trends: '0'
          value_type: TEXT
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.errors
            -
              type: JSONPATH
              parameters:
                - '$.*.*'
            -
              type: TRIM
              parameters:
                - '[]'
            -
              type: JAVASCRIPT
              parameters:
                - |
                  var myArray = value.split(",").join("\r\n");
                  return myArray
                  
          master_item:
            key: 'meraki.sh[errors.list]'
      discovery_rules:
        -
          uuid: 2c00ddc0f3e943b0944a84538286c66c
          name: 'Meraki Host Creation'
          type: EXTERNAL
          key: 'meraki.sh[network.discovery]'
          delay: 1d
          lifetime: 7d
          host_prototypes:
            -
              uuid: 4bc4d43a500e4593ba471d2e0ed33f2f
              host: 'Meraki {#ORG} {#NETWORK_NAME}'
              name: 'Meraki {#ORG} {#NETWORK_NAME}'
              group_links:
                -
                  group:
                    name: Meraki_Autodiscover
              group_prototypes:
                -
                  name: 'Meraki/{#ORG}'
              templates:
                -
                  name: 'Meraki Device Discovery'
              macros:
                -
                  macro: '{$MX_NOTES}'
                  value: '{#MX_NOTES}'
                -
                  macro: '{$NETWORK_ID}'
                  value: '{#NETWORK_ID}'
              custom_interfaces: 'YES'
              interfaces:
                - {  }
  triggers:
    -
      uuid: 88f4cdaf54a44633a554ace41fe10dfb
      expression: 'last(/Meraki Network Discovery/Meraki_error[count])>0 or find(/Meraki Network Discovery/Meraki_error[list],,"like","never match")=1'
      name: 'Test Meraki Data Pull error.'
      priority: AVERAGE
      description: |
        The following is a list of Meraki Organizations with errors preventing monitoring, followed by the error they are experiencing. If this is alerting, open a ticket for each organization with errors, copy the error into the ticket and escalate so that it gets dealt with during business hours. 
        
        {ITEM.VALUE2}
